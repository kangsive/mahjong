# 四川麻将游戏运行规则

## 游戏流程

### 基本流程
```
开始游戏 → 决定庄家(拥有14张牌，闲家13张) → 换三张 → 决定缺门 → 开始出牌
```

### 详细阶段

#### 1. 开始游戏
- 点击"开始游戏"按钮
- 系统自动分配庄家，根据上局游戏结果决定：一炮多响（有人同时胡一张玩家打出来的牌）优先坐庄，否则第一个胡牌的玩家为庄家，如果为第一局游戏，则随机分配庄家
- 庄家获得14张牌，其他玩家获得13张牌

#### 2. 换三张阶段
- **人类玩家操作**：
  - 系统弹出换三张窗口
  - 选择三张同花色的牌（点击牌进行选择/取消）
  - 点击"确认交换"按钮提交
- **AI玩家操作**：
  - AI自动选择数量最多花色的前三张牌
  - 自动提交换牌选择
- **交换方向**：随机决定顺时针或逆时针交换

#### 3. 选择缺门阶段
- **人类玩家操作**：
  - 系统弹出缺门选择窗口
  - 显示当前手牌统计（万、筒、条各多少张）
  - 选择要缺少的花色（万、筒、条之一）
- **AI玩家操作**：
  - AI自动选择牌数最少的花色作为缺门
- **缺门规则**：胡牌时手中不能有缺门的牌

#### 4. 开始出牌阶段
- **回合顺序**：庄家先出牌，然后逆时针轮流
- **界面显示**：
  - 游戏信息栏显示当前游戏状态、剩余牌数、局数
  - 玩家状态栏显示轮到谁出牌
  - 四个玩家状态栏显示各自的详细信息
  - 公共出牌池显示所有已出的牌
  - 手牌区域显示玩家手牌

## 新版界面说明

### 玩家状态栏
游戏界面现在包含四个玩家状态栏，按照麻将桌的传统布局：
- **南 (玩家)** - 人类玩家，位于下方
- **东 (AI-1)** - AI玩家，位于右侧
- **北 (AI-2)** - AI玩家，位于对面
- **西 (AI-3)** - AI玩家，位于左侧

每个玩家状态栏显示：
- **手牌数量**：当前手牌张数
- **明牌信息**：已经碰、杠的牌组合
- **缺门信息**：选择缺少的花色
- **当前状态**：
  - 🎯 轮到你了！（轮到人类玩家）
  - 🤖 AI思考中...（轮到AI玩家）
  - ⏳ 等待中...（等待其他玩家）
  - 🎉 已胡牌（已经胜利）

### 公共出牌池
- 位于界面中央，显示所有玩家已出的牌
- 每张牌显示牌面内容和出牌玩家名字
- 支持水平滚动查看所有出牌历史
- 自动滚动到最新出的牌

### 游戏信息栏
- 显示当前游戏状态（等待开始、发牌中、换三张阶段等）
- 显示剩余牌数和当前局数
- 显示当前轮到哪个玩家的提示信息

## 每名玩家的游戏动作

### 基本动作
1. **摸牌**：系统自动摸牌（轮到该玩家时）
2. **胡牌**：
   - 自摸：自己摸到胡牌（AI会自动胡牌）
   - 点炮：其他玩家打出牌，自己胡牌
3. **碰**：其他任意玩家出牌，自己有两张相同牌可以碰
4. **杠**：
   - 明杠：已有的碰+上家出的牌或者自己摸的牌
   - 暗杠：刻子+自己摸的牌
   - 杠了之后要继续摸一张牌,然后打出一张牌
5. **出牌**：打出一张牌
6. **过**：不执行任何操作，让游戏继续

### 胡牌规则
1. 四个面子+一个对子，面子是可以是刻子，也可以是碰，杠，吃
2. 也可以是7个对子
3. 在标准麻将里（非四川麻将），还可以胡13幺

### 四川麻将特殊规则
- **不能吃牌**：四川麻将只能碰和杠，不能吃
- **缺一门**：必须选择缺少万、筒、条中的一门，胡牌时不能有缺门牌

## 操作方法

### 人类玩家操作
1. **选择手牌**：点击手牌中的牌进行选择（会高亮显示）
2. **出牌**：
   - 方法1：选择手牌后点击"出牌"按钮
   - 方法2：双击手牌直接出牌（未实现）
3. **响应其他玩家出牌**：
   - 点击"胡牌"、"杠"、"碰"按钮执行对应操作
   - 点击"过"按钮放弃操作
4. **自摸胡牌**：轮到自己时，如果可以胡牌，点击"胡牌"按钮

### AI玩家操作
AI玩家完全自动操作：
- **自动出牌**：使用智能算法选择最优出牌
- **自动响应**：根据牌局情况决定是否胡牌、碰牌、杠牌
- **思考时间**：AI操作有1-2秒的思考延迟，模拟真实游戏体验

### 界面提示说明
- **🎯 轮到你了！**：表示现在是你的回合，需要出牌
- **⏳ 等待XXX出牌...**：表示等待其他玩家操作
- **🤖 AI思考中...**：表示AI正在决策
- **🔄 请选择三张同花色的牌**：换三张阶段提示
- **🎲 请选择要缺少的花色**：选择缺门阶段提示

## 游戏顺序

### 标准游戏流程
1. **庄家开始**：庄家（有14张牌）先出一张牌
2. **其他玩家响应**：任意玩家可以选择胡、杠、碰或过
3. **AI自动决策**：AI玩家会根据算法自动选择最优动作
4. **无人响应**：切换到下家，下家摸牌然后决定胡、杠或出牌
5. **重复步骤2-4**：直到有人胡牌
6. **游戏结束**：有人胡牌后，该玩家退出游戏，剩余玩家继续，直到最后两名玩家有一名胡牌

### 特殊情况处理
- **碰牌/杠牌后**：执行碰杠的玩家需要立即出牌
- **多人响应**：胡牌优先级最高，其次是杠，最后是碰
- **AI响应**：AI会智能判断是否执行响应动作

### 血战到底（未完全实现）
- 有人胡牌后，该玩家退出游戏
- 剩余玩家继续，直到最后两名玩家有一名胡牌
- 游戏结束后结算积分

### 计分规则

> https://www.bilibili.com/opus/489955502465652421
> https://ppnav.com/38.html

本节详细说明四川麻将的计分规则，包括基础番型、自摸加底和各种特殊牌型的得分计算。

杠牌当场清（暗杠由未胡牌其他玩家付2分，贴杠由未胡牌其他玩家各付1分，明杠由放杠者付1分）给当前胡牌玩家（与之前已经胡牌的无关），胡牌点炮胡只由放炮者付分，自摸胡牌由未胡牌其他玩家付分，胡牌付分方式为（2^番数+底金）x 关联玩家（自摸为场上未胡牌者，点炮为放炮者）。底金点炮为0，自摸为1。番数参考：https://ppnav.com/38.html。某玩家的总分 = 胡牌得分 + 杠牌得分。



## AI难度说明

本游戏提供多种AI难度，影响AI的决策逻辑和游戏体验。

### Easy (简单)
- **AI模型**: `SimpleAI`
- **特点**:
  - 决策包含大量随机性，容易出现明显失误。
  - 主要基于非常基础的规则（如优先打缺门、孤张）。
  - 适合麻将新手练习基础操作和熟悉游戏流程。

### Medium (中等)
- **AI模型**: `AggressiveAI`
- **特点**:
  - 采用积极进攻的策略，以最快速度组成听牌为目标。
  - 会评估手牌的进张效率，但防守能力较弱。
  - 游戏节奏快，适合有一定经验的玩家。

### Hard (困难)
- **AI模型**: `MctsAI`
- **特点**:
  - 使用**蒙特卡洛树搜索 (MCTS)** 算法进行决策。
  - 通过大量快速的随机模拟来预测游戏未来的走向，从而做出更具前瞻性的决策。
  - 能够更好地平衡进攻和防守，是实力最强的AI对手。
  - 由于计算量较大，AI决策会有几秒钟的"思考"时间。
  - 推荐给希望挑战高水平AI的资深玩家。

## 游戏状态监控

### 实时信息
- **游戏状态**：当前阶段（发牌、换三张、选缺门、游戏中）
- **回合信息**：当前轮到哪个玩家
- **牌局信息**：剩余牌数、出牌历史
- **玩家状态**：每个玩家的手牌数、明牌、缺门情况

### 调试信息
- 消息窗口显示详细的游戏过程
- AI决策和动作会有中文提示
- 错误信息会及时显示

## 注意事项

### 出牌规则
- 只有轮到自己时才能出牌
- 选择手牌后点击"出牌"按钮
- "过"不是出牌，是放弃当前操作机会

### 缺门约束
- 选择缺门后，优先打出缺门的牌
- 胡牌时手中绝对不能有缺门的牌
- 可以碰、杠其他玩家打出的缺门牌

### 系统提示
- 游戏过程中会有中文提示说明当前状态
- 不同阶段有不同的操作窗口
- AI玩家操作会在消息区域显示

### 性能优化
- 界面更新采用差异化刷新，减少闪烁
- AI决策有适当延迟，提升用户体验
- 自动滚动功能确保重要信息可见

## 训练模式特殊功能

### AI指导
- 训练模式下会显示AI建议窗口
- 提供实时的策略指导和建议
- 帮助新手学习麻将技巧

### 学习功能
- 观察AI的决策过程
- 了解不同情况下的最优策略
- 逐步提高麻将水平








